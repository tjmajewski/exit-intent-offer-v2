{% comment %}
  Exit Intent Modal - Loads settings and initializes the modal
{% endcomment %}

{% assign status_json = shop.metafields.exit_intent.status.value %}
{% assign settings_json = shop.metafields.exit_intent.settings.value %}

<script>
  // Parse the JSON settings
  const statusData = {{ status_json | default: '{"enabled":false}' }};
  const settingsData = {{ settings_json | default: '{"modalHeadline":"Wait! Don\'t leave yet üéÅ","modalBody":"Complete your purchase now and get free shipping on your order!","ctaButton":"Complete My Order","exitIntentEnabled":true,"timeDelayEnabled":false,"timeDelaySeconds":30,"cartValueEnabled":false,"cartValueMin":0,"cartValueMax":1000}' }};

  // Pass settings from Shopify to JavaScript
  window.exitIntentSettings = {
    enabled: statusData.enabled || false,
    modalHeadline: settingsData.modalHeadline || "Wait! Don't leave yet üéÅ",
    modalBody: settingsData.modalBody || "Complete your purchase now and get free shipping on your order!",
    ctaButton: settingsData.ctaButton || "Complete My Order",
    triggers: {
      exitIntent: settingsData.exitIntentEnabled !== false,
      timeDelay: settingsData.timeDelayEnabled || false,
      timeDelaySeconds: settingsData.timeDelaySeconds || 30,
      cartValue: settingsData.cartValueEnabled || false,
      minCartValue: settingsData.cartValueMin || 0,
      maxCartValue: settingsData.cartValueMax || 999999
    }
  };
</script>

{{ 'exit-intent-modal.js' | asset_url | script_tag }}